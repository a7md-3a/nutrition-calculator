<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>حاسبة اللياقة البدنية والنظام الغذائي</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f2f7fb;
      font-family: 'Segoe UI', Tahoma, sans-serif;
    }
    .sidebar {
      background: linear-gradient(180deg, #0b74de 0%, #0859b1 100%);
      min-height: 100vh;
      color: white;
      padding: 25px 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }
    .sidebar h2 {
      font-weight: bold;
      margin-bottom: 30px;
      border-bottom: 2px solid rgba(255,255,255,0.2);
      padding-bottom: 15px;
    }
    .content {
      padding: 40px;
    }
    .result {
      background: white;
      padding: 25px;
      border-radius: 12px;
      margin-top: 25px;
      box-shadow: 0 0 15px rgba(0,0,0,0.08);
      color: #333;
      max-height: 500px;
      overflow-y: auto;
    }
    .meal-card {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #0b74de;
    }
    .btn-primary {
      background: linear-gradient(135deg, #0b74de 0%, #0859b1 100%);
      border: none;
      padding: 12px;
      font-weight: 600;
      transition: all 0.3s;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(11, 116, 222, 0.3);
    }
    .bmi-indicator {
      display: flex;
      height: 25px;
      border-radius: 12px;
      overflow: hidden;
      margin: 15px 0;
      border: 1px solid #dee2e6;
    }
    .bmi-range {
      flex: 1;
      text-align: center;
      padding: 3px;
      font-size: 12px;
      color: white;
      font-weight: bold;
    }
    .bmi-pointer {
      position: absolute;
      top: -10px;
      transform: translateX(-50%);
      color: #0b74de;
      font-weight: bold;
    }
    .nav-link {
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 8px;
      transition: all 0.2s;
    }
    .nav-link:hover, .nav-link.active {
      background-color: rgba(255,255,255,0.15);
    }
    .result-header {
      background-color: #0b74de;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .day-plan {
      border-bottom: 1px dashed #dee2e6;
      padding-bottom: 20px;
      margin-bottom: 20px;
    }
    @media (max-width: 768px) {
      .d-flex {
        flex-direction: column;
      }
      .sidebar {
        min-height: auto;
      }
    }
  </style>
</head>
<body>

<div class="d-flex">
  <div class="sidebar col-md-3 col-12">
    <h2>القائمة</h2>
    <ul class="nav flex-column">
      <li class="nav-item"><a href="#" class="nav-link text-white active">الرئيسية</a></li>
      <li class="nav-item"><a href="#" class="nav-link text-white">الحاسبة</a></li>
      <li class="nav-item"><a href="#" class="nav-link text-white">برامج التغذية</a></li>
      <li class="nav-item"><a href="#" class="nav-link text-white">تمارين رياضية</a></li>
      <li class="nav-item"><a href="#" class="nav-link text-white">مقالات</a></li>
      <li class="nav-item"><a href="#" class="nav-link text-white">اتصل بنا</a></li>
    </ul>
  </div>

  <div class="content col-md-9 col-12">
    <h1 class="mb-4 text-primary">حاسبة اللياقة البدنية والنظام الغذائي</h1>
    <p class="text-muted mb-4">احسب احتياجاتك اليومية من السعرات واحصل على خطة غذائية متكاملة لمدة 30 يومًا</p>

    <form id="nutritionForm">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="age" class="form-label">العمر (سنة):</label>
          <input type="number" id="age" class="form-control" min="10" max="100" placeholder="مثلاً: 30" required />
        </div>
        
        <div class="col-md-6 mb-3">
          <label for="gender" class="form-label">الجنس:</label>
          <select id="gender" class="form-select" required>
            <option value="" disabled selected>اختر الجنس</option>
            <option value="male">ذكر</option>
            <option value="female">أنثى</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="height" class="form-label">الطول (سم):</label>
          <input type="number" id="height" class="form-control" min="100" max="230" placeholder="مثلاً: 175" required />
        </div>
        
        <div class="col-md-6 mb-3">
          <label for="weight" class="form-label">الوزن (كغ):</label>
          <input type="number" id="weight" class="form-control" min="30" max="250" placeholder="مثلاً: 70" required />
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="activity" class="form-label">مستوى النشاط البدني:</label>
          <select id="activity" class="form-select" required>
            <option value="" disabled selected>اختر مستوى النشاط</option>
            <option value="1.2">قليل الحركة (قليل التمرين)</option>
            <option value="1.375">تمارين خفيفة 1-3 أيام في الأسبوع</option>
            <option value="1.55">تمارين معتدلة 3-5 أيام في الأسبوع</option>
            <option value="1.725">تمارين كثيفة 6-7 أيام في الأسبوع</option>
            <option value="1.9">نشاط بدني عالي جداً / عمل شاق</option>
          </select>
        </div>
        
        <div class="col-md-6 mb-3">
          <label for="goal" class="form-label">هدف النظام الغذائي:</label>
          <select id="goal" class="form-select" required>
            <option value="" disabled selected>اختر الهدف</option>
            <option value="lose">نقص وزن (خسارة)</option>
            <option value="maintain">الحفاظ على الوزن</option>
            <option value="gain">زيادة وزن (كتلة عضلية)</option>
          </select>
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-100 mt-2">احسب واطلع خطة الـ 30 يوم</button>
    </form>

    <div id="loading" class="text-center my-4" style="display:none;">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">جاري التحميل...</span>
      </div>
      <p>جاري إعداد خطتك الغذائية...</p>
    </div>

    <div id="output" class="result mt-4" style="display:none;"></div>

  </div>
</div>

<script>
// بيانات الوجبات لأنماط مختلفة من السعرات الحرارية
const mealsData = {
  1200: [
    {
      breakfast: [
        { food: "شوفان", qty: "40 جرام", kcal: 150 },
        { food: "حليب خالي الدسم", qty: "كوب", kcal: 80 },
        { food: "موزة صغيرة", qty: "1", kcal: 70 }
      ],
      lunch: [
        { food: "صدر دجاج مشوي", qty: "120 جرام", kcal: 165 },
        { food: "أرز بني", qty: "100 جرام", kcal: 110 },
        { food: "خضار سوتيه", qty: "كوب", kcal: 50 }
      ],
      dinner: [
        { food: "سمك مشوي", qty: "100 جرام", kcal: 140 },
        { food: "سلطة خضراء", qty: "كبير", kcal: 70 }
      ],
      snacks: [
        { food: "جزر", qty: "2 حبة", kcal: 50 },
        { food: "لوز", qty: "10 حبات", kcal: 70 }
      ]
    },
    {
      breakfast: [
        { food: "بيض مسلوق", qty: "2", kcal: 140 },
        { food: "خبز توست", qty: "شريحة", kcal: 70 },
        { food: "جبنة قريش", qty: "50 جرام", kcal: 50 }
      ],
      lunch: [
        { food: "لحم بقري مشوي", qty: "100 جرام", kcal: 200 },
        { food: "بروكلي مطهو على البخار", qty: "كوب", kcal: 55 },
        { food: "بطاطا حلوة", qty: "100 جرام", kcal: 90 }
      ],
      dinner: [
        { food: "دجاج بالخضار", qty: "150 جرام", kcal: 180 },
        { food: "سلطة يوناني", qty: "طبق صغير", kcal: 100 }
      ],
      snacks: [
        { food: "زبادي يوناني", qty: "100 جرام", kcal: 60 },
        { food: "تفاح", qty: "1", kcal: 95 }
      ]
    }
  ],
  1500: [
    {
      breakfast: [
        { food: "عجة بيض", qty: "2 بيضات", kcal: 180 },
        { food: "جبنة فيتا", qty: "30 جرام", kcal: 75 },
        { food: "خبز أسمر", qty: "شريحة", kcal: 70 }
      ],
      lunch: [
        { food: "سلمون مشوي", qty: "150 جرام", kcal: 280 },
        { food: "كينوا", qty: "100 جرام", kcal: 120 },
        { food: "خضار مشكل", qty: "طبق", kcal: 80 }
      ],
      dinner: [
        { food: "دجاج بالكاري", qty: "150 جرام", kcal: 220 },
        { food: "أرز بسمتي", qty: "100 جرام", kcal: 130 }
      ],
      snacks: [
        { food: "مكسرات مشكلة", qty: "30 جرام", kcal: 180 },
        { food: "برتقال", qty: "1", kcal: 60 }
      ]
    },
    {
      breakfast: [
        { food: "سموثي أخضر", qty: "كوب", kcal: 200 },
        { food: "توست أفوكادو", qty: "شريحة", kcal: 180 }
      ],
      lunch: [
        { food: "شوربة عدس", qty: "طبق", kcal: 220 },
        { food: "سلطة التونة", qty: "طبق", kcal: 180 },
        { food: "خبز قمح كامل", qty: "شريحة", kcal: 70 }
      ],
      dinner: [
        { food: "كفتة الدجاج", qty: "150 جرام", kcal: 250 },
        { food: "تبولة", qty: "طبق صغير", kcal: 150 }
      ],
      snacks: [
        { food: "حمص", qty: "50 جرام", kcal: 160 },
        { food: "خيار", qty: "2", kcal: 30 }
      ]
    }
  ],
  1800: [
    {
      breakfast: [
        { food: "بان كيك بروتين", qty: "2", kcal: 280 },
        { food: "عسل", qty: "ملعقة", kcal: 60 },
        { food: "موزة", qty: "1", kcal: 100 }
      ],
      lunch: [
        { food: "ستيك لحم", qty: "180 جرام", kcal: 320 },
        { food: "بطاطا مشوية", qty: "150 جرام", kcal: 130 },
        { food: "خضار مشكل", qty: "طبق", kcal: 100 }
      ],
      dinner: [
        { food: "معكرونة قمح كامل", qty: "150 جرام", kcal: 200 },
        { food: "صلصة بولونيز", qty: "100 جرام", kcal: 150 },
        { food: "سلطة سيزر", qty: "طبق", kcal: 180 }
      ],
      snacks: [
        { food: "بروتين شيك", qty: "1 سكوب", kcal: 120 },
        { food: "تمر", qty: "5 حبات", kcal: 120 }
      ]
    },
    {
      breakfast: [
        { food: "أومليت بالخضار", qty: "3 بيضات", kcal: 280 },
        { food: "جبنة شيدر", qty: "30 جرام", kcal: 120 },
        { food: "خبز توست", qty: "2 شرائح", kcal: 140 }
      ],
      lunch: [
        { food: "برجر الدجاج", qty: "1", kcal: 350 },
        { food: "بطاطا حلوة", qty: "150 جرام", kcal: 135 },
        { food: "سلطة خضراء", qty: "طبق", kcal: 80 }
      ],
      dinner: [
        { food: "سمك فيليه مشوي", qty: "200 جرام", kcal: 280 },
        { food: "أرز بسمتي", qty: "150 جرام", kcal: 195 },
        { food: "خضار سوتيه", qty: "كوب", kcal: 50 }
      ],
      snacks: [
        { food: "زبادي بالفواكه", qty: "كوب", kcal: 150 },
        { food: "لوز", qty: "20 حبة", kcal: 140 }
      ]
    }
  ],
  2200: [
    {
      breakfast: [
        { food: "شوفان مع حليب كامل", qty: "60 جرام", kcal: 230 },
        { food: "موزة", qty: "1", kcal: 100 },
        { food: "لوز", qty: "30 جرام", kcal: 180 },
        { food: "عسل", qty: "ملعقة", kcal: 60 }
      ],
      lunch: [
        { food: "صدر دجاج", qty: "200 جرام", kcal: 330 },
        { food: "أرز بسمتي", qty: "200 جرام", kcal: 260 },
        { food: "خضار مشكل", qty: "طبق", kcal: 100 },
        { food: "سلطة أفوكادو", qty: "طبق", kcal: 200 }
      ],
      dinner: [
        { food: "لحم بقري مشوي", qty: "200 جرام", kcal: 350 },
        { food: "بطاطا مهروسة", qty: "150 جرام", kcal: 150 },
        { food: "خضار سوتيه", qty: "كوب", kcal: 50 }
      ],
      snacks: [
        { food: "بروتين شيك", qty: "1 سكوب", kcal: 120 },
        { food: "توست مع زبدة الفول السوداني", qty: "2 شرائح", kcal: 300 },
        { food: "تفاح", qty: "1", kcal: 95 }
      ]
    },
    {
      breakfast: [
        { food: "بيض مقلي", qty: "4 بيضات", kcal: 280 },
        { food: "شريحة لحم مقدد", qty: "2", kcal: 100 },
        { food: "خبز توست", qty: "2 شرائح", kcal: 140 },
        { food: "أفوكادو", qty: "نصف", kcal: 120 }
      ],
      lunch: [
        { food: "معكرونة باللحم المفروم", qty: "300 جرام", kcal: 450 },
        { food: "سلطة يوناني", qty: "طبق", kcal: 200 },
        { food: "خبز ثوم", qty: "2 قطعة", kcal: 150 }
      ],
      dinner: [
        { food: "سلمون مشوي", qty: "250 جرام", kcal: 420 },
        { food: "بطاطا مشوية", qty: "200 جرام", kcal: 180 },
        { food: "بروكلي", qty: "كوب", kcal: 55 }
      ],
      snacks: [
        { food: "سموثي بروتين", qty: "كوب", kcal: 250 },
        { food: "مكسرات مشكلة", qty: "50 جرام", kcal: 300 }
      ]
    }
  ]
};

// حساب معدل الأيض الأساسي (BMR)
function calculateBMR(weight, height, age, gender) {
  if (gender === 'male') {
    return 10 * weight + 6.25 * height - 5 * age + 5;
  } else {
    return 10 * weight + 6.25 * height - 5 * age - 161;
  }
}

// تقريب السعرات الحرارية إلى أقرب نطاق
function roundCalories(calories) {
  if (calories < 1350) return 1200;
  else if (calories < 1650) return 1500;
  else if (calories < 2000) return 1800;
  else return 2200;
}

// توليد خطة غذائية لمدة 30 يومًا
function generatePlan(band) {
  const days = [];
  const availableDays = mealsData[band].length;
  
  for (let i = 1; i <= 30; i++) {
    // استخدام نمط متكرر مع تغييرات طفيفة
    const dayIndex = (i - 1) % availableDays;
    days.push({
      day: i,
      meals: JSON.parse(JSON.stringify(mealsData[band][dayIndex]))
    });
    
    // إضافة تغييرات طفيفة لتجنب التكرار الممل
    if (i % 7 === 0) {
      const snackIndex = Math.floor(Math.random() * days[i-1].meals.snacks.length);
      if (days[i-1].meals.snacks[snackIndex]) {
        days[i-1].meals.snacks[snackIndex].food = "بديل: " + days[i-1].meals.snacks[snackIndex].food;
      }
    }
  }
  
  return days;
}

// حساب مؤشر كتلة الجسم وتصنيفه
function calculateBMI(weight, height) {
  const bmiValue = (weight / ((height / 100) ** 2)).toFixed(1);
  let bmiCategory = "";
  
  if (bmiValue < 18.5) bmiCategory = "نقص في الوزن";
  else if (bmiValue < 25) bmiCategory = "وزن طبيعي";
  else if (bmiValue < 30) bmiCategory = "زيادة في الوزن";
  else bmiCategory = "سمنة";
  
  return { value: bmiValue, category: bmiCategory };
}

// تنسيق الوجبات للعرض
function formatMealHtml(name, items) {
  let total = 0;
  let html = `<div class="meal-card">
                <h5 class="mb-3">${name}:</h5>
                <ul class="mb-0">`;
  
  items.forEach(item => {
    html += `<li>${item.qty} ${item.food} (${item.kcal} سعرة حرارية)</li>`;
    total += item.kcal;
  });
  
  html += `</ul>
           <p class="mt-2 mb-0"><strong>المجموع:</strong> ${total} سعرة حرارية</p>
           </div>`;
  return html;
}

// عرض الخطة كاملة
function renderPlan(age, gender, height, weight, activity, goal) {
  // حساب BMR و TDEE
  const bmr = calculateBMR(weight, height, age, gender);
  let tdee = Math.round(bmr * activity);
  
  // تعديل السعرات حسب الهدف
  if (goal === "lose") tdee = Math.round(tdee - 500);
  else if (goal === "gain") tdee = Math.round(tdee + 400);
  
  // الحد الأدنى للسعرات الحرارية
  if (tdee < 1200) tdee = 1200;
  
  // تحديد نطاق السعرات
  const band = roundCalories(tdee);
  
  // حساب مؤشر كتلة الجسم
  const bmi = calculateBMI(weight, height);
  
  // توليد الخطة الغذائية
  const planDays = generatePlan(band);
  
  // بناء واجهة النتائج
  let html = `<div class="result-header">
                <h4 class="mb-3">نتائج التحليل</h4>
                <div class="row">
                  <div class="col-md-6">
                    <p class="mb-1"><strong>العمر:</strong> ${age} سنة</p>
                    <p class="mb-1"><strong>الجنس:</strong> ${gender === "male" ? "ذكر" : "أنثى"}</p>
                    <p class="mb-1"><strong>الطول:</strong> ${height} سم</p>
                  </div>
                  <div class="col-md-6">
                    <p class="mb-1"><strong>الوزن:</strong> ${weight} كغ</p>
                    <p class="mb-1"><strong>مستوى النشاط:</strong> ${document.querySelector('#activity option:checked').textContent}</p>
                    <p class="mb-1"><strong>الهدف:</strong> ${document.querySelector('#goal option:checked').textContent}</p>
                  </div>
                </div>
              </div>`;
  
  html += `<div class="mb-4">
              <h5 class="mb-3">المؤشرات الصحية</h5>
              <p><strong>معدل الأيض الأساسي (BMR):</strong> ${Math.round(bmr)} سعرة حرارية/يوم</p>
              <p><strong>إجمالي السعرات اليومية (TDEE):</strong> ${tdee} سعرة حرارية/يوم</p>
              <p><strong>مؤشر كتلة الجسم (BMI):</strong> ${bmi.value} (${bmi.category})</p>
              
              <div class="bmi-indicator mt-4 position-relative">
                <div class="bmi-range" style="background-color: #3498db;">&lt; 18.5</div>
                <div class="bmi-range" style="background-color: #2ecc71;">18.5 - 25</div>
                <div class="bmi-range" style="background-color: #f39c12;">25 - 30</div>
                <div class="bmi-range" style="background-color: #e74c3c;">&gt; 30</div>
                <span class="bmi-pointer" style="left: ${Math.min(Math.max((bmi.value - 15) * 4, 5), 95)}%;">▲</span>
              </div>
            </div>`;
  
  html += `<h5 class="mb-3">خطة غذائية تفصيلية لمدة 30 يوم</h5>
            <p class="text-muted mb-4">نظامك الغذائي اليومي يحتوي على ${band} سعرة حرارية</p>`;
  
  // عرض أول 3 أيام كمثال
  for (let i = 0; i < 3; i++) {
    const day = planDays[i];
    html += `<div class="day-plan">
              <h6 class="mb-3">اليوم ${day.day}:</h6>
              ${formatMealHtml("الفطور", day.meals.breakfast)}
              ${formatMealHtml("الغداء", day.meals.lunch)}
              ${formatMealHtml("العشاء", day.meals.dinner)}
              ${formatMealHtml("السناكات", day.meals.snacks)}
            </div>`;
  }
  
  html += `<div class="alert alert-info mt-4">
            <strong>ملاحظة:</strong> تم عرض أول 3 أيام كمثال. سيتم إرسال الخطة الكاملة المكونة من 30 يومًا إلى بريدك الإلكتروني.
          </div>
          <div class="mt-4">
            <button class="btn btn-outline-primary me-2">حفظ الخطة كـ PDF</button>
            <button class="btn btn-outline-success">إرسال إلى بريدي الإلكتروني</button>
          </div>`;
  
  return html;
}

// إدارة عملية الإرسال وعرض النتائج
document.getElementById("nutritionForm").addEventListener("submit", e => {
  e.preventDefault();
  
  // إظهار مؤشر التحميل
  const loading = document.getElementById("loading");
  const output = document.getElementById("output");
  loading.style.display = "block";
  output.style.display = "none";
  
  // الحصول على القيم من النموذج
  const age = parseInt(document.getElementById("age").value);
  const gender = document.getElementById("gender").value;
  const height = parseInt(document.getElementById("height").value);
  const weight = parseInt(document.getElementById("weight").value);
  const activity = parseFloat(document.getElementById("activity").value);
  const goal = document.getElementById("goal").value;
  
  // التحقق من صحة البيانات
  if (!age || !gender || !height || !weight || !activity || !goal) {
    alert("يرجى تعبئة جميع الحقول بشكل صحيح.");
    loading.style.display = "none";
    return;
  }
  
  // تأخير عملية الحساب لعرض مؤشر التحميل
  setTimeout(() => {
    try {
      const planHtml = renderPlan(age, gender, height, weight, activity, goal);
      output.style.display = "block";
      output.innerHTML = planHtml;
      loading.style.display = "none";
      window.scrollTo({ top: output.offsetTop, behavior: "smooth" });
    } catch (error) {
      console.error(error);
      loading.style.display = "none";
      alert("حدث خطأ أثناء توليد الخطة. يرجى المحاولة مرة أخرى.");
    }
  }, 1500);
});
</script>

</body>
</html>
